<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>VM test cluster using JeOS/MinimalVM images -</title><meta name=description content="JeOS (Just enough OS) or MinimalVM images are minimal VM images (duh!) that can be used to quickly deploy VMs. Instead of a installation you only need to go through a first boot setup. This makes those images very handy if you need to spin up a bunch of test VMs as for instance if you need a custom cluster."><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"openQA bites","url":"https:\/\/openQA-Bites.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/openQA-Bites.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/openQA-Bites.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/openQA-Bites.github.io\/posts\/2023\/2023-03-08-vm_test_cluster_using_jeos\/","name":"Vm test cluster using je os minimal vm images"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"phoenix"},"headline":"VM test cluster using JeOS\/MinimalVM images","description":"JeOS (Just enough OS) or MinimalVM images are minimal VM images (duh!) that can be used to quickly deploy VMs. Instead of a installation you only need to go through a first boot setup. This makes those images very handy if you need to spin up a bunch of test VMs as for instance if you need a custom cluster.\n","inLanguage":"en","wordCount":472,"datePublished":"2023-03-08T14:41:06\u002b01:00","dateModified":"2023-03-08T14:41:06\u002b01:00","image":"https:\/\/openQA-Bites.github.io\/img\/avatar-icon.png","keywords":["tools, testing, virtualization, jeos"],"mainEntityOfPage":"https:\/\/openQA-Bites.github.io\/posts\/2023\/2023-03-08-vm_test_cluster_using_jeos\/","publisher":{"@type":"Organization","name":"https:\/\/openQA-Bites.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/openQA-Bites.github.io\/img\/avatar-icon.png","height":60,"width":60}}}</script><meta property="og:title" content="VM test cluster using JeOS/MinimalVM images"><meta property="og:description" content="JeOS (Just enough OS) or MinimalVM images are minimal VM images (duh!) that can be used to quickly deploy VMs. Instead of a installation you only need to go through a first boot setup. This makes those images very handy if you need to spin up a bunch of test VMs as for instance if you need a custom cluster."><meta property="og:image" content="https://openQA-Bites.github.io/img/avatar-icon.png"><meta property="og:url" content="https://openQA-Bites.github.io/posts/2023/2023-03-08-vm_test_cluster_using_jeos/"><meta property="og:type" content="website"><meta property="og:site_name" content="openQA bites"><meta name=twitter:title content="VM test cluster using JeOS/MinimalVM images"><meta name=twitter:description content="JeOS (Just enough OS) or MinimalVM images are minimal VM images (duh!) that can be used to quickly deploy VMs. Instead of a installation you only need to go through a first boot setup. This makes â€¦"><meta name=twitter:image content="https://openQA-Bites.github.io/img/avatar-icon.png"><meta name=twitter:card content="summary_large_image"><link href=https://openQA-Bites.github.io/img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.151.0"><link rel=alternate href=https://openQA-Bites.github.io/index.xml type=application/rss+xml title="openQA bites"><link rel=stylesheet href=https://openQA-Bites.github.io/css/katex.min.css><link rel=stylesheet href=https://openQA-Bites.github.io/fontawesome/css/all.css><link rel=stylesheet href=https://openQA-Bites.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://openQA-Bites.github.io/css/main.css><link rel=stylesheet href=https://openQA-Bites.github.io/css/custom.css><link rel=stylesheet href=https://openQA-Bites.github.io/css/fonts.css><link rel=stylesheet href=https://openQA-Bites.github.io/css/syntax.css><link rel=stylesheet href=https://openQA-Bites.github.io/css/codeblock.css><link rel=stylesheet href=https://openQA-Bites.github.io/css/photoswipe.min.css><link rel=stylesheet href=https://openQA-Bites.github.io/css/photoswipe.default-skin.min.css></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://openQA-Bites.github.io/>openQA bites</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>openQA</a><div class=navlinks-children><a href=https://openQA-Bites.github.io/openqa/openqa-cli-cheat-sheet>openqa-cli cheat sheet</a>
<a href=https://openQA-Bites.github.io/posts/2023/2023-02-23-safely_clone_a_job_on_a_production_instance/>cloning jobs on production instance</a></div></li><li><a title=Categories href=https://openQA-Bites.github.io/categories/>Categories</a></li><li><a title=Tags href=https://openQA-Bites.github.io/tags/>Tags</a></li><li><a title=About href=https://openQA-Bites.github.io/about/>About</a></li><li><a title=Related href=https://openQA-Bites.github.io/related/>Related</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="openQA bites" href=https://openQA-Bites.github.io/><img class=avatar-img src=https://openQA-Bites.github.io/img/avatar-icon.png alt="openQA bites"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>VM test cluster using JeOS/MinimalVM images</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on March 8, 2023
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;3&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;472&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;phoenix</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>JeOS (Just enough OS) or MinimalVM images are minimal VM images (duh!) that can be used to quickly deploy VMs. Instead of a installation you only need to go through a first boot setup. This makes those images very handy if you need to spin up a bunch of test VMs as for instance if you need a custom cluster.</p><p>In my particular case I needed to spin up a Salt Master/Minion cluster with 1 master and 2 minions.</p><p>Disclaimer: There are more advanced settings like e.g. <a href=https://en.opensuse.org/Portal:JeOS:Documentation:libguestfs-tools>libguestfs-tools</a> that allow further customization and automation of the task, for the purpose of simplicity I will stick to the basics. Installation for JeOS images takes less than 1 minute, and for just a small number of VMs it&rsquo;s just fine to do this by hand.</p><h1 id=setting-up-a-vm-cluster-with-3-opensuse-hosts-in-5-minutes>Setting up a VM cluster with 3 openSUSE hosts in 5 minutes</h1><p>(Possible slow download time excluded)</p><p>We are going to perform the following setup:</p><ul><li>3 VM hosts that will use the same JeOS VM image</li><li>Each host has it&rsquo;s own disk as qemu overlay disk</li><li>We will not automate the JeOS installation itself, because for 3 machines it&rsquo;s not necessary</li></ul><h2 id=setting-up-the-vm-disks>Setting up the VM disks</h2><p>First, download the latest JeOS image. I used Leap for my setup, you can use Tumbleweed or whatever you like. Download the latest image from <a href=http://get.opensuse.org/>get.opensuse.org</a> and go to the Alternative Downloads. There you find the KVM and XEN image (or the corresponding other images).</p><p><img src=download.png alt="In the Alternative Downloads window select the KVM and XEN image"></p><p>Assuming the JeOS image is <code>openSUSE-Leap-15.4-JeOS.x86_64-kvm-and-xen.qcow2</code> we now create three disks as qemu overlay images. This means all of them will use the <code>openSUSE-Leap-15.4-JeOS.x86_64-kvm-and-xen.qcow2</code> image as underlying base image and only the changes of the corresponding system will be stored in the overlay. All VMs will be using the same base image and only their own stuff will be stored in their own qcow2 disk image - that&rsquo;s neat!</p><p>To create the disks <code>master.qcow2</code>, <code>minion1.qcow2</code> and <code>minion2.qcow2</code> with 30GiB each, we do</p><pre tabindex=0><code>qemu-img create -b openSUSE-Leap-15.4-JeOS.x86_64-kvm-and-xen.qcow2 -F qcow2 -f qcow2 master.qcow2 30G
qemu-img create -b openSUSE-Leap-15.4-JeOS.x86_64-kvm-and-xen.qcow2 -F qcow2 -f qcow2 minion1.qcow2 30G
qemu-img create -b openSUSE-Leap-15.4-JeOS.x86_64-kvm-and-xen.qcow2 -F qcow2 -f qcow2 minion2.qcow2 30G
</code></pre><p>Now you can just use the resulting disk images <code>master.qcow2</code>, <code>minion1.qcow2</code> and <code>minion2.qcow2</code> when creating your VMs</p><h2 id=create-the-vms>Create the VMs</h2><p>We just use <code>virt-install</code> to create VMs from the already existing disk images. As said before, the installation process is so simple, that for just a handful of machines it&rsquo;s really no issue to do this manually.</p><pre><code># Execute one after another
virt-install --name=salt-master --disk=/srv/virt/images/master.qcow2 --import --os-variant=opensuse15.4 --vcpus=2 --ram=2048
virt-install --name=salt-minion1 --disk=/srv/virt/images/minion1.qcow2 --import --os-variant=opensuse15.4 --vcpus=2 --ram=2048
virt-install --name=salt-minion2 --disk=/srv/virt/images/minion2.qcow2 --import --os-variant=opensuse15.4 --vcpus=2 --ram=2048
</code></pre><p>The installation takes less than a minute</p><p><img src=install.gif alt="JeOS installation walkthrough"></p><p>And that&rsquo;s it. In less than 5 minutes you should be up and running with your own 3 VMs cluster using JeOS or MinimalVM images ðŸ˜€</p><div class=blog-tags><a href=https://openQA-Bites.github.io/tags/tools/>tools</a>&nbsp;
<a href=https://openQA-Bites.github.io/tags/testing/>testing</a>&nbsp;
<a href=https://openQA-Bites.github.io/tags/virtualization/>virtualization</a>&nbsp;
<a href=https://openQA-Bites.github.io/tags/jeos/>jeos</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fopenQA-Bites.github.io%2fposts%2f2023%2f2023-03-08-vm_test_cluster_using_jeos%2f&amp;text=VM%20test%20cluster%20using%20JeOS%2fMinimalVM%20images&amp;via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fopenQA-Bites.github.io%2fposts%2f2023%2f2023-03-08-vm_test_cluster_using_jeos%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fopenQA-Bites.github.io%2fposts%2f2023%2f2023-03-08-vm_test_cluster_using_jeos%2f&amp;title=VM%20test%20cluster%20using%20JeOS%2fMinimalVM%20images" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fopenQA-Bites.github.io%2fposts%2f2023%2f2023-03-08-vm_test_cluster_using_jeos%2f&amp;title=VM%20test%20cluster%20using%20JeOS%2fMinimalVM%20images" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fopenQA-Bites.github.io%2fposts%2f2023%2f2023-03-08-vm_test_cluster_using_jeos%2f&amp;title=VM%20test%20cluster%20using%20JeOS%2fMinimalVM%20images" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fopenQA-Bites.github.io%2fposts%2f2023%2f2023-03-08-vm_test_cluster_using_jeos%2f&amp;description=VM%20test%20cluster%20using%20JeOS%2fMinimalVM%20images" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://openQA-Bites.github.io/posts/2023/2023-02-23-safely_clone_a_job_on_a_production_instance/ data-toggle=tooltip data-placement=top title="Safely clone a job on a production instance">&larr; Previous Post</a></li><li class=next><a href=https://openQA-Bites.github.io/posts/2023/2023-03-13-tap_not_permitted/ data-toggle=tooltip data-placement=top title="openQA: Could not configure /dev/net/tun (tap3): Operation not permitted">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:felix.niederwanger@suse.de title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/grisu48 title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/felix-niederwanger title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a rel=me href=https://chaos.social/@phoenix title=Mastodon><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">phoenix
&nbsp;&bull;&nbsp;&copy;
2025
&nbsp;&bull;&nbsp;
<a href=https://openQA-Bites.github.io/>openQA bites</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.151.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://openQA-Bites.github.io/js/katex.min.js></script><script defer src=https://openQA-Bites.github.io/js/auto-render.min.js onload=renderMathInElement(document.body)></script><script src=https://openQA-Bites.github.io/js/jquery-3.7.0.slim.min.js></script><script src=https://openQA-Bites.github.io/js/bootstrap.min.js></script><script src=https://openQA-Bites.github.io/js/main.js></script><script src=https://openQA-Bites.github.io/js/photoswipe.min.js></script><script src=https://openQA-Bites.github.io/js/photoswipe-ui-default.min.js></script><script src=https://openQA-Bites.github.io/js/load-photoswipe.js></script></body></html>